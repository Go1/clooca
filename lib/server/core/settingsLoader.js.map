{"version":3,"sources":["server/core/settingsLoader.js"],"names":["fs","require","path","module","exports","parsedArgs","settingsFile","settings","userDir","join","process","env","HOME","HOMEPATH","USERPROFILE","userSettingsFile","existsSync","defaultSettings","__dirname","settingsStat","statSync","mtime","getTime","ctime","copySync","err","console","log","exit"],"mappings":";;AAAA,IAAIA,KAAKC,QAAQ,UAAR,CAAT;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;;AAEAE,OAAOC,OAAP,GAAiB,UAASC,UAAT,EAAqB;AACrC,KAAIC,YAAJ;;AAEA,KAAID,WAAWE,QAAf,EAAyB;AACrBD,iBAAeD,WAAWE,QAA1B;AACH,EAFD,MAEO;AACH,MAAIC,UAAUH,WAAWG,OAAX,IAAsBN,KAAKO,IAAL,CAAUC,QAAQC,GAAR,CAAYC,IAAZ,IAAoBF,QAAQC,GAAR,CAAYE,QAAhC,IAA4CH,QAAQC,GAAR,CAAYG,WAAlE,EAA+E,SAA/E,CAApC;AACA,MAAIC,mBAAmBb,KAAKO,IAAL,CAAUD,OAAV,EAAmB,aAAnB,CAAvB;AACA,MAAIR,GAAGgB,UAAH,CAAcD,gBAAd,CAAJ,EAAqC;AACjCT,kBAAeS,gBAAf;AACH,GAFD,MAEO;AACH,OAAIE,kBAAkBf,KAAKO,IAAL,CAAUS,SAAV,EAAqB,sBAArB,CAAtB;AACA,OAAIC,eAAenB,GAAGoB,QAAH,CAAYH,eAAZ,CAAnB;AACA,OAAIE,aAAaE,KAAb,CAAmBC,OAAnB,KAA+BH,aAAaI,KAAb,CAAmBD,OAAnB,EAAnC,EAAiE;AAC7DtB,OAAGwB,QAAH,CAAYP,eAAZ,EAA4BF,gBAA5B;AACAT,mBAAeS,gBAAf;AACH,IAHD,MAGO;AACHT,mBAAeW,eAAf;AACH;AACJ;AACJ;;AAED,KAAI;AACA,MAAIV,WAAWN,QAAQK,YAAR,CAAf;AACAC,WAASD,YAAT,GAAwBA,YAAxB;AACH,EAHD,CAGE,OAAMmB,GAAN,EAAW;AACTC,UAAQC,GAAR,CAAY,iBAAZ,EAA+BrB,YAA/B,EAA6CmB,GAA7C;AACAf,UAAQkB,IAAR;AACH;;AAED,KAAGpB,WAAW,CAACD,SAASC,OAAxB,EAAiC;AAChCD,WAASC,OAAT,GAAmBA,OAAnB;AACA;;AAED,QAAOD,QAAP;AACA,CAnCD","file":"settingsLoader.js","sourcesContent":["var fs = require('fs-extra');\nvar path = require('path');\n\nmodule.exports = function(parsedArgs) {\n\tvar settingsFile;\n\n\tif (parsedArgs.settings) {\n\t    settingsFile = parsedArgs.settings;\n\t} else {\n\t    var userDir = parsedArgs.userDir || path.join(process.env.HOME || process.env.HOMEPATH || process.env.USERPROFILE, \".clooca\");\n\t    var userSettingsFile = path.join(userDir, \"settings.js\");\n\t    if (fs.existsSync(userSettingsFile)) {\n\t        settingsFile = userSettingsFile;\n\t    } else {\n\t        var defaultSettings = path.join(__dirname, \"../../../settings.js\");\n\t        var settingsStat = fs.statSync(defaultSettings);\n\t        if (settingsStat.mtime.getTime() < settingsStat.ctime.getTime()) {\n\t            fs.copySync(defaultSettings,userSettingsFile);\n\t            settingsFile = userSettingsFile;\n\t        } else {\n\t            settingsFile = defaultSettings;\n\t        }\n\t    }\n\t}\n\n\ttry {\n\t    var settings = require(settingsFile);\n\t    settings.settingsFile = settingsFile;\n\t} catch(err) {\n\t    console.log(\"Loading Error: \", settingsFile, err);\n\t    process.exit();\n\t}\n\n\tif(userDir && !settings.userDir) {\n\t\tsettings.userDir = userDir;\n\t}\n\n\treturn settings;\n}\n"]}